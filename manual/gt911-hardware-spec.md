# GT911 タッチコントローラハードウェア仕様書

## 1. 概要

GT911は、Goodix社製の高性能静電容量式タッチスクリーンコントローラです。最大5点のマルチタッチをサポートし、7〜8インチのタッチパネルに最適化されています。I²C通信による簡単なインターフェース、低消費電力、高いノイズ耐性を特徴としています。

## 2. 主要仕様

| 項目 | 仕様 |
|-----|-----|
| チャンネル数 | 26 (Txチャンネル) × 14 (Rxチャンネル) |
| 対応スクリーンサイズ | 7〜8インチ |
| 同時検出可能タッチ点数 | 最大5点 |
| レポートレート | 100Hz (最大) |
| 通信インターフェース | I²C（スレーブモード） |
| I²Cスレーブアドレス | 0xBA/0xBB または 0x28/0x29 (設定可能) |
| 電源電圧 | 2.8V〜3.3V (単一電源) |
| ホストインターフェース電圧 | 1.8V〜3.3V |
| 動作温度 | -40℃〜+85℃ |

## 3. 動作モード

| モード | 説明 |
|------|------|
| ノーマルモード | 通常動作モード。最小座標更新サイクルは7ms-10ms |
| グリーンモード | スキャンサイクル約40ms。タッチを検出すると自動的にノーマルモードへ |
| ジェスチャーモード | スワイプ、ダブルタップ、文字入力などでウェイクアップ可能 |
| スリープモード | 低消費電力モード。ホストからのI²Cコマンドで入り、INTピンのHIGHで復帰 |
| アプローチモード | HotKnot機能使用時の近接検出モード |

## 4. 消費電流

| 動作モード | 標準値 | 最大値 | 単位 |
|---------|------|------|-----|
| ノーマルモード | 8 | 14.5 | mA |
| グリーンモード | 3.3 | - | mA |
| スリープモード | - | 120 | μA |
| ドーズモード | 0.78 | - | mA |

## 5. ピン配置

| ピン番号 | ピン名 | タイプ | 説明 |
|--------|------|------|------|
| 1 | VDD | P | 電源入力 (2.8V-3.3V) |
| 2 | GND | P | グラウンド |
| 3 | SCL | I | I²Cクロック入力 |
| 4 | SDA | I/O | I²Cデータ入出力 |
| 5 | INT | O | 割り込み出力 (タッチ検出通知) |
| 6 | RSTB | I | リセット入力 (ローアクティブ) |
| 7 | VDDIO | P | I/O電源入力 (1.8V-3.3V) |

注意:
- INTピンはプルアップが必要です
- RSTBピンはプルアップが必要です
- 2.2μF GNDへのフィルタコンデンサ推奨

## 6. 接続例

```
      3.3V
       │
       ├── 10kΩ     ┌─── MCU ───┐
       │            │            │
       ├── 10kΩ     │            │
       │            │            │
┌──────┴─────┐      │            │
│    VDD     │      │            │
│            │      │            │
│    SCL     ├──────┤ SCL        │
│            │      │            │
│    SDA     ├──────┤ SDA        │
│            │      │            │
│    INT     ├──────┤ GPIO_INT   │
│            │      │            │
│    RSTB    ├──────┤ GPIO_RST   │
│            │      │            │
│    VDDIO   │      │            │
│            │      │            │
│    GND     ├──────┤ GND        │
└────────────┘      └────────────┘
     GT911

```

## 7. I²C通信

### 7.1 I²Cアドレス選択
GT911のI²Cアドレスは起動時の設定によって以下のいずれかになります：
- 0x5D (7ビットアドレス、0xBA/0xBB 8ビット形式)
- 0x14 (7ビットアドレス、0x28/0x29 8ビット形式)

### 7.2 レジスタ読み取り手順
1. レジスタアドレスを設定するために書き込みオペレーション実行
2. 再スタート条件を送信
3. 読み取りアドレスを送信
4. データの読み取り
5. 最後のバイトの後にNACKを送信
6. ストップ条件を送信

### 7.3 レジスタ書き込み手順
1. 書き込みアドレスを送信
2. レジスタアドレスを送信
3. データを送信
4. ストップ条件を送信

## 8. リセット手順

以下の手順でGT911をリセットし、正しいI²Cアドレスで起動させることができます：

1. INT信号を入力モードに設定
2. RSTBをLOWに設定（リセット開始）
3. 20ms待機
4. INTをLOWに設定
5. 50ms待機
6. RSTBをHIGHに設定（リセット終了）
7. 100ms待機
8. INTを出力モードに設定
9. 100ms待機

## 9. レジスタマップ

GT911の主要なレジスタグループ：

### 9.1 リアルタイムコマンド (書き込み専用)

| アドレス | 名前 | 説明 |
|---------|------|------|
| 0x8040 | Command | 動作モード制御コマンド |
| 0x8041 | ESD_Check | ESD保護メカニズム用フラグ |
| 0x8046 | Command_Check | ESD対策用コマンド確認 |

### 9.2 設定情報 (読み書き可能)

| アドレス | 名前 | 説明 |
|---------|------|------|
| 0x8047 | Config_Version | 設定バージョン |
| 0x8048-0x8049 | X Output Max | X解像度 |
| 0x804A-0x804B | Y Output Max | Y解像度 |
| 0x804C | Touch Number | タッチポイント数（1〜5） |
| 0x804D | Module_Switch1 | 軸反転、INT設定等 |
| 0x804E | Module_switch2 | 機能有効化設定 |
| 0x8053 | Screen_Touch_Level | タッチ検出しきい値 |
| 0x8054 | Screen_Leave_Level | タッチリリースしきい値 |
| 0x8056 | Refresh_Rate | レポートレート |

### 9.3 ステータスと座標データ

| アドレス | 名前 | 説明 |
|---------|------|------|
| 0x814E | Status | タッチステータスレジスタ |
| 0x8150 | Point1_X | 最初のタッチポイントのX座標 |
| 0x8152 | Point1_Y | 最初のタッチポイントのY座標 |
| 0x8154 | Point1_Size | 最初のタッチポイントのサイズ |
| 0x8155 | Point1_TrackID | 最初のタッチポイントの追跡ID |

### 9.4 タッチキー設定

| アドレス | 名前 | 説明 |
|---------|------|------|
| 0x8093 | Key1 | キー1のアドレス |
| 0x8094 | Key2 | キー2のアドレス |
| 0x8095 | Key3 | キー3のアドレス |
| 0x8096 | Key4 | キー4のアドレス |
| 0x8097 | Key_Area | キー領域設定 |
| 0x8098 | Key_Touch_Level | キータッチしきい値 |
| 0x8099 | Key_Leave_Level | キーリリースしきい値 |

## 10. モジュールスイッチ設定 (0x804D)

| ビット | 名前 | 機能 |
|------|------|------|
| bit7 | Driver_Resersal(Y2Y) | 1=Y軸反転 |
| bit6 | Sensor_Resersal(X2X) | 1=X軸反転 |
| bit3 | X2Y | 1=X/Y軸入れ替え |
| bit2 | Sito | 1=ソフトウェアノイズ低減有効 |
| bit1-0 | INT Trigger | 00=立ち上がりエッジ, 01=立下りエッジ, 02=Lowレベル, 03=Highレベル |

## 11. 主要コマンド (0x8040)

| 値 | 機能 |
|----|------|
| 0x00 | 座標読取モード |
| 0x05 | スクリーンオフ/スリープモード |
| 0x06 | チャージモード開始 |
| 0x07 | チャージモード終了 |
| 0x08 | ジェスチャーモード |
| 0xAA | ESD保護メカニズム有効 |

## 12. 設定手順

1. リセット実行
2. 製品IDの確認 (0x8140から4バイト)
3. 設定データの送信 (0x8047から0x80FE)
4. チェックサム計算と設定 (0x80FF)
5. 設定更新フラグを設定 (0x8100)
6. コマンドレジスタを0x00に設定

## 13. トラブルシューティング

| 問題 | 可能な原因 | 対処法 |
|-----|----------|-------|
| 応答なし | I²Cアドレス不一致 | リセット手順を確認 |
| 応答なし | 電源不足 | 電源電圧を確認 |
| 座標異常 | X/Y解像度設定ミス | 0x8048-0x804Bの設定確認 |
| タッチ感度問題 | しきい値設定不適切 | 0x8053-0x8054の設定確認 |
| 断続的なタッチ | ノイズ干渉 | フィルタリング設定を調整 |

## 14. 参考資料

- GT911データシート
- Goodix GT911コントローラ設計ガイド
- タッチパネル・コントローラ詳細設計マニュアル
